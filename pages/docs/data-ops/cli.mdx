import { Callout, Card, Cards } from "nextra-theme-docs";

# Using the Glean CLI

The Glean CLI allows you to create Preview and Deploy Builds directly from your terminal or continuous integration system.

<Cards>
  <Card arrow title="CLI Quickstart" href="/docs/cli/quickstart" />
  <Card arrow title="glean build" href="/docs/cli/commands/build" />
</Cards>

## Using environment variables

You can use environment variables to dynamically populate Glean configuration files with different values at runtime.

When creating a Build using local files, the CLI will replace placeholders of the form `${ENV_VAR_NAME}` with the corresponding environment variable. For example, if your model file contains:

```yaml
glean: "1.0"
name: My Data Model
source:
  connectionName: ${DATABASE_CONNECTION_NAME}
  physicalName: test_table
```

...then you can preview a Build against your `dev` database by running:

```bash
$ DATABASE_CONNECTION_NAME=dev glean preview
```

Environment variable substitution is not yet supported for Builds that are triggered via a git revision.

## Recommended workflows

The CLI allows you to integrate Glean into your existing development and deployment process. As an example, here is a typical workflow that we use when making changes to Glean resources or upstream data:

1. Store your Glean configuration files in a git repo alongside your data pipeline code.
2. Run your pipelines to populate test data into a separate database or schema.
3. Adjust your Glean configuration files as necessary to reflect your intended changes.
4. Run `glean preview` to create a Preview Build, adjusting the `source` section of your model(s) to point at your test dataset.
5. Make any necessary adjustments in the Preview and re-export your new configuration files.
6. Send a Pull Request for all the pending changes, including a link to your Preview Build.
7. Merge the Pull Request into your `main` git branch.
8. Run `glean deploy --git-revision=main` to deploy your new Glean resources to your project.

## Continuous integration

You can invoke the Glean CLI in a continuous integration system to automatically generate previews or deploy your project.

For example, if you use GitHub, the following GitHub action will generate a Build Preview of the local `glean` directory whenever you send a pull request:

```yaml
name: glean-preview
on: [pull_request]
jobs:
  create-glean-preview:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - run: pip install glean-cli
      - run: cd glean && glean preview
    env:
      GLEAN_PROJECT_ID: ${{ secrets.GLEAN_PROJECT_ID_PROD }}
      GLEAN_ACCESS_KEY_ID: ${{ secrets.GLEAN_ACCESS_KEY_ID_PROD }}
      GLEAN_SECRET_ACCESS_KEY_TOKEN: ${{ secrets.GLEAN_SECRET_ACCESS_KEY_TOKEN_PROD }}
```

## dbt Utility

`glean preview` and `glean deploy` can optionally accept a flag, `--dbt`, which runs `dbt parse` and then uses the resulting manifest for the corresponding Glean build. See the [dbt integration documentation](./dbt-integration.mdx) for more information about the Glean dbt integration.
